<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <!-- =========================================================
         META / SEO B√ÅSICO
         ========================================================= -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- T√≠tulo da aplica√ß√£o (aba do navegador) -->
    <title>Dashboard - Sistema de Indicadores</title>

    <!-- =========================================================
         CSS / JS
         - CSS do layout (styles.css)
         - JS principal (script.js) carregado com defer
           para garantir que o DOM j√° exista antes do script rodar
         ========================================================= -->
    <link rel="stylesheet" href="/static/styles.css">
    <script src="/static/script.js" defer></script>
</head>

<body>
    <!-- =========================================================
         1) TELA DE LOGIN
         - Vis√≠vel por padr√£o
         - Ap√≥s login, o JS deve ocultar (#loginScreen) e mostrar (#sectorsScreen)
         ========================================================= -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">

            <!-- Cabe√ßalho do login -->
            <div class="login-header">
                <h1>Brasitalia</h1>
                <p>Sistema de Indicadores</p>
            </div>

            <!-- Campo: Email/Usu√°rio -->
            <div class="form-group">
                <label>User</label>
                <input
                    type="email"
                    id="emailInput"
                    placeholder="email"
                    autocomplete="username"
                >
            </div>

            <!-- Campo: Senha + bot√£o de visualiza√ß√£o -->
            <div class="form-group">
                <label>Senha</label>

                <div class="password-toggle">
                    <input
                        type="password"
                        id="senhaInput"
                        placeholder="senha"
                        autocomplete="current-password"
                    >

                    <!-- Bot√£o olho: chama fun√ß√£o JS togglePassword() -->
                    <button type="button" onclick="togglePassword()">üëÅÔ∏è</button>
                </div>
            </div>

            <!-- A√ß√£o: Login -->
            <button class="login-btn" onclick="handleLogin()">Entrar</button>
        </div>
    </div>


    <!-- =========================================================
         2) TELA DE SETORES
         - Inicia oculta (hidden)
         - Exibe lista de setores (JS popula #sectorsGrid)
         - Exibe hist√≥rico de envios (opcional, #historySection)
         ========================================================= -->
    <div id="sectorsScreen" class="hidden">
        <!-- Header padr√£o do sistema (bem-vindo + bot√µes) -->
        <header>
            <div class="header-container">
                <!-- Sauda√ß√£o e instru√ß√£o -->
                <div class="header-content">
                    <h1>
                        Bem-vindo, <span id="userNameDisplay">Usu√°rio</span>!
                    </h1>
                    <p>Selecione um setor para preencher indicadores</p>
                </div>

                <!-- Bot√£o Admin: fica hidden por padr√£o e o JS decide mostrar -->
                <button
                    id="adminBtn"
                    class="admin-btn hidden"
                    onclick="showAdminScreen()"
                >
                    Admin
                </button>

                <!-- Logout -->
                <button class="logout-btn" onclick="handleLogout()">üö™ Sair</button>
            </div>
        </header>

        <!-- Conte√∫do principal da tela de setores -->
        <div class="sectors-container">
            <!-- Grid onde os bot√µes de setores ser√£o gerados dinamicamente -->
            <div class="sectors-grid" id="sectorsGrid"></div>

            <!-- Hist√≥rico de envios (opcional / controlado pelo JS) -->
            <div class="history-section hidden" id="historySection">
                <h2>Hist√≥rico de Envios</h2>

                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Usu√°rio</th>
                            <th>Setor</th>
                            <th>Data/Hora</th>
                            <th>Status</th>
                        </tr>
                    </thead>

                    <!-- Corpo preenchido pelo JS -->
                    <tbody id="historyBody"></tbody>
                </table>
            </div>
        </div>
    </div>


    <!-- =========================================================
         3) TELA ADMIN
         - Inicia oculta
         - Possui navega√ß√£o interna: Usu√°rios / Indicadores
         - Usu√°rios tem subnav: criar usu√°rio, setor, editar setor, lista
         ========================================================= -->
    <div id="adminScreen" class="hidden">
        <header>
            <div class="header-container">
                <!-- √Årea esquerda: bot√£o voltar + t√≠tulo -->
                <div class="indicators-header">
                    <button class="back-btn" onclick="backToSectorsFromAdmin()"><-</button>

                    <div class="header-content">
                        <h1>Administra√ß√£o</h1>
                        <p>Usuarios e indicadores</p>
                    </div>
                </div>

                <!-- Logout -->
                <button class="logout-btn" onclick="handleLogout()">Sair</button>
            </div>
        </header>

        <!-- Conte√∫do admin -->
        <div class="admin-container">

            <!-- Navega√ß√£o principal admin -->
            <div class="admin-nav">
                <button class="btn btn-save admin-tab" onclick="showAdminSection('users')">
                    Usuarios
                </button>
                <button class="btn btn-send admin-tab" onclick="showAdminSection('indicators')">
                    Indicadores
                </button>
            </div>


            <!-- =========================
                 ADMIN: SE√á√ÉO USU√ÅRIOS
                 ========================= -->
            <div class="admin-section" id="adminUsersSection">
                <h2>Usuarios</h2>

                <!-- Subnavega√ß√£o Usu√°rios -->
                <div class="admin-subnav">
                    <button class="btn btn-save admin-tab" onclick="showUsersSection('createUser')">Criar usuario</button>
                    <button class="btn btn-save admin-tab" onclick="showUsersSection('createSetor')">Criar setor</button>
                    <button class="btn btn-send admin-tab" onclick="showUsersSection('editSetor')">Editar setor</button>
                    <button class="btn btn-save admin-tab" onclick="showUsersSection('listUsers')">Lista usuarios</button>
                </div>

                <!-- Cards Usu√°rios/Setores -->
                <div class="admin-grid">

                    <!-- Card: Criar usu√°rio -->
                    <div class="admin-card" id="adminCreateUserCard">
                        <h3>Criar usuario</h3>

                        <div class="form-group">
                            <label>Nome</label>
                            <input id="adminUserNome" type="text" placeholder="Nome" autocomplete="name">
                        </div>

                        <div class="form-group">
                            <label>Email</label>
                            <input id="adminUserEmail" type="email" placeholder="email@empresa.com" autocomplete="email">
                        </div>

                        <div class="form-group">
                            <label>Setor</label>
                            <select id="adminUserSetor"></select>
                        </div>

                        <div class="form-group">
                            <label>Nivel</label>
                            <select id="adminUserNivel"></select>
                        </div>

                        <div class="form-group">
                            <label>Senha</label>
                            <input id="adminUserSenha" type="password" placeholder="1234" autocomplete="new-password">
                        </div>

                        <button class="btn btn-save" onclick="adminCreateUser()">Criar usuario</button>
                    </div>


                    <!-- Card: Editar usu√°rio (hidden por padr√£o) -->
                    <div class="admin-card hidden" id="adminEditUserCard">
                        <h3>Editar usuario</h3>

                        <div class="form-group">
                            <label>ID</label>
                            <input id="adminUserId" type="text" readonly>
                        </div>

                        <div class="form-group">
                            <label>Nome</label>
                            <input id="adminUserNomeEdit" type="text">
                        </div>

                        <div class="form-group">
                            <label>Email</label>
                            <input id="adminUserEmailEdit" type="email">
                        </div>

                        <div class="form-group">
                            <label>Setor</label>
                            <select id="adminUserSetorEdit"></select>
                        </div>

                        <div class="form-group">
                            <label>Nivel</label>
                            <select id="adminUserNivelEdit"></select>
                        </div>

                        <div class="form-group">
                            <label>
                                <input id="adminUserAtivoEdit" type="checkbox"> Ativo
                            </label>
                        </div>

                        <div class="admin-actions">
                            <button class="btn btn-save" onclick="adminUpdateUser()">Salvar</button>
                            <button class="btn btn-send" onclick="adminResetUserPassword()">Resetar senha</button>
                        </div>
                    </div>


                    <!-- Card: Criar setor (hidden por padr√£o) -->
                    <div class="admin-card hidden" id="adminCreateSetorCard">
                        <h3>Criar setor</h3>

                        <div class="form-group">
                            <label>Nome do setor</label>
                            <input id="adminSetorNome" type="text" placeholder="Nome do setor">
                        </div>

                        <button class="btn btn-save" onclick="adminCreateSetor()">Criar setor</button>
                    </div>


                    <!-- Card: Editar setor (hidden por padr√£o) -->
                    <div class="admin-card hidden" id="adminEditSetorCard">
                        <h3>Editar setor</h3>

                        <div class="form-group">
                            <label>ID</label>
                            <input id="adminSetorId" type="text" readonly>
                        </div>

                        <div class="form-group">
                            <label>Nome</label>
                            <input id="adminSetorNomeEdit" type="text">
                        </div>

                        <div class="form-group">
                            <label>
                                <input id="adminSetorAtivoEdit" type="checkbox"> Ativo
                            </label>
                        </div>

                        <div class="admin-actions">
                            <button class="btn btn-save" onclick="adminUpdateSetor()">Salvar</button>
                            <button class="btn btn-send" onclick="adminDisableSetor()">Inativar</button>
                        </div>
                    </div>
                </div>


                <!-- Tabela: Setores (hidden por padr√£o) -->
                <div class="admin-table-wrap hidden" id="adminSetoresTableWrap">
                    <table class="history-table admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Nome</th>
                                <th>Ativo</th>
                                <th>Acao</th>
                            </tr>
                        </thead>
                        <tbody id="adminSetoresBody"></tbody>
                    </table>
                </div>


                <!-- Tabela: Usu√°rios (hidden por padr√£o) -->
                <div class="admin-table-wrap hidden" id="adminUsersTableWrap">
                    <table class="history-table admin-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Permissao</th>
                                <th>Acoes</th>
                            </tr>
                        </thead>
                        <tbody id="adminUsersBody"></tbody>
                    </table>
                </div>
            </div>


            <!-- =========================
                 ADMIN: SE√á√ÉO INDICADORES
                 ========================= -->
            <div class="admin-section hidden" id="adminIndicadoresSection">
                <h2>Indicadores</h2>

                <div class="admin-grid">
                    <!-- Card: Criar indicador -->
                    <div class="admin-card">
                        <h3>Criar indicador</h3>

                        <div class="form-group">
                            <label>Setor</label>
                            <select id="adminIndicadorSetor"></select>
                        </div>

                        <div class="form-group">
                            <label>Codigo</label>
                            <input id="adminIndicadorCodigo" type="text" placeholder="COD01">
                        </div>

                        <div class="form-group">
                            <label>Nome</label>
                            <input id="adminIndicadorNome" type="text" placeholder="Nome do indicador">
                        </div>

                        <div class="form-group">
                            <label>Tipo</label>
                            <input id="adminIndicadorTipo" type="text" placeholder="number/date">
                        </div>

                        <div class="form-group">
                            <label>Unidade</label>
                            <input id="adminIndicadorUnidade" type="text" placeholder="unidade">
                        </div>

                        <div class="form-group">
                            <label>Meta</label>
                            <input id="adminIndicadorMeta" type="number" step="any" placeholder="0">
                        </div>

                        <div class="form-group">
                            <label>Responsavel por preenhcer</label>
                            <select id="adminIndicadorResponsavel"></select>
                        </div>

                        <button class="btn btn-save" onclick="adminCreateIndicador()">Criar indicador</button>
                    </div>

                    <!-- Card: Editar indicador -->
                    <div class="admin-card">
                        <h3>Editar indicador</h3>

                        <div class="form-group">
                            <label>ID</label>
                            <input id="adminIndicadorId" type="text" readonly>
                        </div>

                        <div class="form-group">
                            <label>Setor (lista)</label>
                            <select id="adminIndicadorSetorEdit"></select>
                        </div>

                        <div class="form-group">
                            <label>Nome</label>
                            <input id="adminIndicadorNomeEdit" type="text">
                        </div>

                        <div class="form-group">
                            <label>Tipo</label>
                            <input id="adminIndicadorTipoEdit" type="text">
                        </div>

                        <div class="form-group">
                            <label>Unidade</label>
                            <input id="adminIndicadorUnidadeEdit" type="text">
                        </div>

                        <div class="form-group">
                            <label>Meta</label>
                            <input id="adminIndicadorMetaEdit" type="number" step="any">
                        </div>

                        <div class="form-group">
                            <label>Responsavel</label>
                            <select id="adminIndicadorResponsavelEdit"></select>
                        </div>

                        <div class="form-group">
                            <label>
                                <input id="adminIndicadorAtivoEdit" type="checkbox"> Ativo
                            </label>
                        </div>

                        <button class="btn btn-save" onclick="adminUpdateIndicador()">Salvar</button>
                    </div>
                </div>

                <!-- Tabela: lista indicadores -->
                <div class="admin-table-wrap">
                    <table class="history-table admin-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Codigo</th>
                                <th>Nome</th>
                                <th>Tipo</th>
                                <th>Unidade</th>
                                <th>Meta</th>
                                <th>Resp</th>
                                <th>Ativo</th>
                                <th>Acao</th>
                            </tr>
                        </thead>
                        <tbody id="adminIndicadoresBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <!-- =========================================================
         4) TELA DE INDICADORES (POR SETOR)
         - Inicia oculta
         - JS define o t√≠tulo do setor (#sectorTitle)
         - JS gera os campos dentro de #indicatorsForm
         ========================================================= -->
    <div id="indicatorsScreen" class="hidden">
        <header>
            <div class="header-container">
                <div class="indicators-header">
                    <!-- Voltar para setores -->
                    <button class="back-btn" onclick="backToSectors()">‚Üê</button>

                    <!-- T√≠tulo e subt√≠tulo -->
                    <div class="header-content">
                        <h1 id="sectorTitle">Setor</h1>
                        <p>Preencha os indicadores abaixo</p>
                    </div>
                </div>

                <!-- Logout -->
                <button class="logout-btn" onclick="handleLogout()">üö™ Sair</button>
            </div>
        </header>

        <div class="indicators-content">
            <!-- Form gerado dinamicamente pelo JS -->
            <div class="indicators-form" id="indicatorsForm"></div>

            <!-- A√ß√µes principais -->
            <div class="action-buttons">
                <button class="btn btn-save" id="saveBtn" onclick="handleSave()">üíæ Salvar</button>
                <button class="btn btn-send" id="sendBtn" onclick="handleSendDB()">üì§ Enviar para DB</button>
            </div>

            <!-- √öltimos registros (opcional / controlado pelo JS) -->
            <div class="recent-records hidden" id="recentRecords">
                <h2>√öltimos Registros</h2>
                <div id="recordsList"></div>
            </div>
        </div>
    </div>
</body>
</html>
